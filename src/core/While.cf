-------------------------------------------------------------------------------
-- A grammer of WHILE
-- p.29 (online version p.32)
-- http://www.diku.dk/~neil/comp2book2007/book-whole.pdf
-------------------------------------------------------------------------------
--
-- Variables   ∋ X, Y
-- Expressions ∋ E, F ::= X | d | cons E F | hd E | tl E | =? E F
-- Commands    ∋ C, D ::= X := E; | while E do { C* }
-- Programs    ∋ P    ::= read X; C; write Y
--
-------------------------------------------------------------------------------

entrypoints Proc, Val;


-------------------------------------------------------------------------------
-- Program
-------------------------------------------------------------------------------

AProc. Proc ::= "read" Ident ";" [Com] "write" Ident;


-------------------------------------------------------------------------------
-- Command
-------------------------------------------------------------------------------

CAsn.  Com ::= Ident ":=" Exp ";" ;              -- Assignment
CLoop. Com ::= "while" Exp "do" "{" [Com] "}" ;  -- While loop
terminator Com "" ;
layout "do" ;


-------------------------------------------------------------------------------
-- Expression
-------------------------------------------------------------------------------

ECons. Exp  ::= "cons" Exp1 Exp1 ;
EHd.   Exp  ::= "hd" Exp1 ;
ETl.   Exp  ::= "tl" Exp1 ;
EEq.   Exp  ::= "=?" Exp1 Exp1 ;     -- Equality check
EVar.  Exp1 ::= Ident ;
EVal.  Exp1 ::= Val ;
coercions Exp 1;


-------------------------------------------------------------------------------
-- Value
-------------------------------------------------------------------------------

VNil.  Val  ::= "nil" ;
VAtom. Val  ::= Atom ;          -- ex. 'a, 'loop
VCons. Val  ::= "(" Val "." Val ")" ;


-------------------------------------------------------------------------------
-- Misc
-------------------------------------------------------------------------------

token Atom '\'' (digit | letter)+;                  -- ex. 'val, '32, 
comment "(*" "*)" ;
